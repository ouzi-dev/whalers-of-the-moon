REPO := quay.io/ouzi/toolbox
TAG ?= 0.1.19

GO_BUILDER_TAG ?= 1.14.0
HELM_VERSION ?= v3.3.4
KUBECTL_VERSION ?= v1.19.2
AWS_CLI_VERSION ?= 1.18.156
TF_VERSION ?= 0.13.4
GOTPL_VERSION ?= v0.7
CREDSTASH_VERSION ?= 1.16.1
GCLOUD_VERSION ?= 278.0.0
YQ_VERSION ?= 3.4.0
KUBEVAL_VERSION ?= 0.15.0

.PHONY: build push

build:
	@gcloud builds submit --config cloudbuild-build.yaml \
				--substitutions=_TAG_VERSION=$(TAG),_QUAY_REPO=$(REPO)\
,_HELM_VERSION="$(HELM_VERSION)"\
,_GO_BUILDER_TAG="$(GO_BUILDER_TAG)"\
,_KUBECTL_VERSION="$(KUBECTL_VERSION)"\
,_AWS_CLI_VERSION="$(AWS_CLI_VERSION)"\
,_TF_VERSION="$(TF_VERSION)"\
,_GOTPL_VERSION="$(GOTPL_VERSION)"\
,_CREDSTASH_VERSION="$(CREDSTASH_VERSION)"\
,_GCLOUD_VERSION="$(GCLOUD_VERSION)"\
,_YQ_VERSION="$(YQ_VERSION)"\
,_KUBEVAL_VERSION="$(KUBEVAL_VERSION)"

push:
	@gcloud builds submit --config cloudbuild-push.yaml \
				--substitutions=_TAG_VERSION=$(TAG),_QUAY_REPO=$(REPO)\
,_HELM_VERSION="$(HELM_VERSION)"\
,_GO_BUILDER_TAG="$(GO_BUILDER_TAG)"\
,_KUBECTL_VERSION="$(KUBECTL_VERSION)"\
,_AWS_CLI_VERSION="$(AWS_CLI_VERSION)"\
,_TF_VERSION="$(TF_VERSION)"\
,_GOTPL_VERSION="$(GOTPL_VERSION)"\
,_CREDSTASH_VERSION="$(CREDSTASH_VERSION)"\
,_GCLOUD_VERSION="$(GCLOUD_VERSION)"\
,_YQ_VERSION="$(YQ_VERSION)"\
,_KUBEVAL_VERSION="$(KUBEVAL_VERSION)"